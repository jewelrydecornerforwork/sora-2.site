# 🎬 视频生成功能配置指南

## 问题诊断

您遇到的 **"生成不了视频"** 问题是因为缺少 AI API 配置。

现在我已经为您创建了 `.env.local` 文件，接下来需要配置免费的 AI API 密钥。

---

## 🚀 快速解决方案（3 个步骤）

### 步骤 1: 选择一个免费 API 服务

我推荐您选择以下**任意一个**（或两个都配置）：

| 服务 | 免费额度 | 质量 | 速度 | 推荐 |
|------|---------|------|------|------|
| **Replicate** | 每月 $5 积分（约50次） | ⭐⭐⭐⭐⭐ | 快 | ✅ 推荐 |
| **Hugging Face** | 完全免费 | ⭐⭐⭐⭐ | 中等 | ✅ 备选 |

---

### 步骤 2: 获取 API 密钥

#### 方案 A: Replicate API（推荐）

1. **注册账号**
   - 访问：https://replicate.com/
   - 点击 "Sign Up"，使用 GitHub 登录或邮箱注册

2. **获取 API Token**
   - 登录后访问：https://replicate.com/account/api-tokens
   - 点击 "Create token"
   - 复制生成的 token（格式：`r8_xxxxx...`）

3. **配置到项目**
   - 打开 `.env.local` 文件
   - 找到 `REPLICATE_API_TOKEN=""`
   - 将您的 token 填入引号中：
     ```env
     REPLICATE_API_TOKEN="r8_xxxxx..."
     ```

#### 方案 B: Hugging Face API（完全免费）

1. **注册账号**
   - 访问：https://huggingface.co/
   - 点击 "Sign Up"，填写邮箱注册

2. **创建 Access Token**
   - 登录后访问：https://huggingface.co/settings/tokens
   - 点击 "New token"
   - 名称：`sora-2-video-generator`
   - 权限：选择 **"Read"**
   - 点击 "Generate token"
   - 复制生成的 token（格式：`hf_xxxxx...`）

3. **配置到项目**
   - 打开 `.env.local` 文件
   - 找到 `HF_API_TOKEN=""`
   - 将您的 token 填入引号中：
     ```env
     HF_API_TOKEN="hf_xxxxx..."
     ```

---

### 步骤 3: 重启开发服务器

配置完成后，**必须重启服务器**才能生效：

```bash
# 1. 停止当前服务器（按 Ctrl+C）
# 2. 重新启动
npm run dev
```

---

## ✅ 验证配置

### 方法 1: 查看启动日志

重启服务器后，查看终端输出，应该看到：

```
🔑 API 密钥状态: { hasReplicateToken: true, hasHFToken: false }
```

或

```
🔑 API 密钥状态: { hasReplicateToken: false, hasHFToken: true }
```

### 方法 2: 测试生成视频

1. 访问 http://localhost:3000
2. 上传一张图片
3. 输入运动描述，例如：
   ```
   A woman walks on the beach at sunset, waves gently rolling in the background
   ```
4. 点击 "Generate Video"
5. 查看终端日志：
   ```
   📡 使用 Replicate API 生成视频...
   ⏳ 预测 ID: xxxxxx
   📊 状态: processing
   ✅ 视频生成成功
   ```

---

## 💡 推荐配置（同时配置两个 API）

为了获得最佳体验，建议同时配置两个 API：

```env
# 优先使用 Replicate（质量最佳）
REPLICATE_API_TOKEN="r8_xxxxx..."

# 备选使用 Hugging Face（完全免费）
HF_API_TOKEN="hf_xxxxx..."
```

**工作原理**：
- 系统会优先使用 Replicate（质量更好）
- 如果 Replicate 失败或额度用完，自动切换到 Hugging Face
- 如果两者都失败，回退到演示模式

---

## ❓ 常见问题

### Q1: 配置后还是生成演示视频？

**原因**：
- API Token 未正确填入
- 未重启开发服务器
- Token 格式错误（缺少引号或有空格）

**解决**：
1. 检查 `.env.local` 文件中 token 是否正确
2. 确保 token 在引号内：`REPLICATE_API_TOKEN="r8_xxxxx"`
3. 重启开发服务器

### Q2: Replicate 提示 "Unauthorized" 错误

**原因**：Token 无效或格式错误

**解决**：
1. 检查 token 是否包含 `r8_` 前缀
2. 重新复制 token，确保完整
3. 在 Replicate 网站检查 token 状态

### Q3: Hugging Face 提示 "503 Service Unavailable"

**原因**：模型正在冷启动（正常现象）

**解决**：
- 等待 20 秒后重试
- 这是免费服务的正常限制

### Q4: 视频生成很慢怎么办？

**正常生成时间**：
- Replicate: 30-60 秒
- Hugging Face: 首次 40-60 秒（冷启动），之后 20-30 秒

**如果超过 2 分钟**：
- 检查网络连接
- 查看终端是否有错误信息
- 刷新页面重试

---

## 🎯 完整配置示例

打开 `.env.local` 文件后，应该看到类似内容：

```env
# 推荐：至少配置一个
REPLICATE_API_TOKEN="r8_BpLkzf9QX..."  # 填入您的 Replicate token
HF_API_TOKEN="hf_MnKjHgFdS..."        # 或填入您的 HuggingFace token

# 其他配置（可选）
NEXTAUTH_SECRET="your-secret-key-here"
NEXTAUTH_URL="http://localhost:3000"
APP_NAME="Sora-2 Ai"
APP_URL="http://localhost:3000"
```

---

## 📚 相关资源

- **Replicate 文档**: https://replicate.com/docs
- **Hugging Face 文档**: https://huggingface.co/docs/api-inference
- **项目详细配置**: 查看 `FREE_API_SETUP.md`
- **部署指南**: 查看 `README.md`

---

## 🆘 需要帮助？

如果按照以上步骤操作后仍然无法生成视频，请提供：

1. 终端的错误日志
2. 浏览器控制台的错误信息
3. `.env.local` 文件配置（隐藏 token 值）

我会立即协助您解决问题！

---

**最后提醒**：
⚠️ 不要将 `.env.local` 文件提交到 Git 仓库（已自动忽略）
⚠️ 不要分享您的 API Token 给任何人
✅ 定期检查 Replicate 的免费额度使用情况

配置完成后，您就可以尽情使用 AI 视频生成功能了！🎉

